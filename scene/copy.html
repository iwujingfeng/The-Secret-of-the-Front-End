<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据拷贝 | 前端核心技术与应用场景揭秘</title>
    <meta name="description" content="从实际应用场景出发，彻底掌握核心技术">
    <link rel="icon" href="/The-Secret-of-the-Front-End/logo.png">
  <link rel="manifest" href="/The-Secret-of-the-Front-End/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/The-Secret-of-the-Front-End/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/The-Secret-of-the-Front-End/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/The-Secret-of-the-Front-End/assets/css/0.styles.c71dac19.css" as="style"><link rel="preload" href="/The-Secret-of-the-Front-End/assets/js/app.d61db1a3.js" as="script"><link rel="preload" href="/The-Secret-of-the-Front-End/assets/js/10.e0b122c8.js" as="script"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/17.edd76cd2.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/1.d12300eb.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/2.396f006c.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/3.bfb9f7b8.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/4.93769201.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/5.16586269.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/6.9b588305.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/7.59216026.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/8.b421ad78.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/9.e4a1e545.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/11.e78c9ad2.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/12.23ab4971.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/13.a92485af.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/14.df5bb8f9.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/15.39f7f39a.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/16.7ddf6876.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/18.eeb1a7b6.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/19.09a7dd16.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/20.e9d7ad50.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/21.6427ee9a.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/22.067d5c78.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/23.0a9ef729.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/24.dad5827a.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/25.830618d8.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/26.e69e851d.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/27.cf9440e0.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/28.5c28df11.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/29.9a166935.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/30.14740bf5.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/31.2c582c6f.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/32.54b7a172.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/33.f019adad.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/34.edde84ce.js"><link rel="prefetch" href="/The-Secret-of-the-Front-End/assets/js/35.13d58945.js">
    <link rel="stylesheet" href="/The-Secret-of-the-Front-End/assets/css/0.styles.c71dac19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/The-Secret-of-the-Front-End/" class="home-link router-link-active"><!----> <span class="site-name">前端核心技术与应用场景揭秘</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/The-Secret-of-the-Front-End/core/" class="nav-link">核心技术</a></div><div class="nav-item"><a href="/The-Secret-of-the-Front-End/scene/" class="nav-link router-link-active">应用场景</a></div><div class="nav-item"><a href="/The-Secret-of-the-Front-End/question/" class="nav-link">经典问答</a></div> <a href="https://github.com/iwujingfeng/The-Secret-of-the-Front-End" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/The-Secret-of-the-Front-End/core/" class="nav-link">核心技术</a></div><div class="nav-item"><a href="/The-Secret-of-the-Front-End/scene/" class="nav-link router-link-active">应用场景</a></div><div class="nav-item"><a href="/The-Secret-of-the-Front-End/question/" class="nav-link">经典问答</a></div> <a href="https://github.com/iwujingfeng/The-Secret-of-the-Front-End" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>应用场景</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/The-Secret-of-the-Front-End/scene/type.html" class="sidebar-link">类型判断</a></li><li><a href="/The-Secret-of-the-Front-End/scene/type-conversion.html" class="sidebar-link">类型转换</a></li><li><a href="/The-Secret-of-the-Front-End/scene/array-distinct.html" class="sidebar-link">数组去重</a></li><li><a href="/The-Secret-of-the-Front-End/scene/object-distinct.html" class="sidebar-link">对象去重</a></li><li><a href="/The-Secret-of-the-Front-End/scene/array-traversal.html" class="sidebar-link">遍历数组</a></li><li><a href="/The-Secret-of-the-Front-End/scene/object-traversal.html" class="sidebar-link">遍历对象</a></li><li><a href="/The-Secret-of-the-Front-End/scene/array-filter.html" class="sidebar-link">数组过滤</a></li><li><a href="/The-Secret-of-the-Front-End/scene/copy.html" class="active sidebar-link">数据拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#一、从赋值操作说起" class="sidebar-link">一、从赋值操作说起</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#二、浅拷贝" class="sidebar-link">二、浅拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#循环实现浅拷贝" class="sidebar-link">循环实现浅拷贝</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#object-assign-实现浅拷贝" class="sidebar-link">Object.assign()实现浅拷贝</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#slice-实现浅拷贝" class="sidebar-link">slice()实现浅拷贝</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#concat-实现浅拷贝" class="sidebar-link">concat()实现浅拷贝</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#扩展运算符实现浅拷贝" class="sidebar-link">扩展运算符实现浅拷贝</a></li></ul></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#三、深拷贝" class="sidebar-link">三、深拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#json-解析" class="sidebar-link">JSON 解析</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#浅拷贝-递归实现深拷贝" class="sidebar-link">浅拷贝+递归实现深拷贝</a></li><li class="sidebar-sub-header"><a href="/The-Secret-of-the-Front-End/scene/copy.html#我愿与你共享知识-可否陪我共饮香茗" class="sidebar-link">我愿与你共享知识 可否陪我共饮香茗 🍵</a></li></ul></li></ul></li><li><a href="/The-Secret-of-the-Front-End/scene/async.html" class="sidebar-link">异步处理</a></li><li><a href="/The-Secret-of-the-Front-End/scene/regexp-match.html" class="sidebar-link">正则匹配</a></li><li><a href="/The-Secret-of-the-Front-End/scene/string-handle.html" class="sidebar-link">字符串处理</a></li><li><a href="/The-Secret-of-the-Front-End/scene/number-handle.html" class="sidebar-link">数字处理</a></li><li><a href="/The-Secret-of-the-Front-End/scene/arr-handle.html" class="sidebar-link">数组处理</a></li><li><a href="/The-Secret-of-the-Front-End/scene/object-handle.html" class="sidebar-link">对象处理</a></li><li><a href="/The-Secret-of-the-Front-End/scene/date-handle.html" class="sidebar-link">日期处理</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="数据拷贝"><a href="#数据拷贝" aria-hidden="true" class="header-anchor">#</a> 数据拷贝</h1> <p>项目中数组和对象的拷贝操作极为常见,譬如，需要编辑一个表格（数据格式为数组，单元格为对象格式），需要把原始数据拷贝到编辑页，然后编辑内容后，点击保存来更新表格。如果使用了浅拷贝，会导致编辑内容时，还未执行保存，原始内容就已经被修改。如果对浅拷贝和深拷贝没有深入理解，这类不可预估的问题就会出现。深拷贝和浅拷贝只针对 <code>Object</code> 和 <code>Array</code> 这样的引用数据类型。</p> <h2 id="一、从赋值操作说起"><a href="#一、从赋值操作说起" aria-hidden="true" class="header-anchor">#</a> 一、从赋值操作说起</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 基本数据类型赋值</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newStr <span class="token operator">=</span> str<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;基本数据类型赋值&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> newStr<span class="token punctuation">,</span> str <span class="token operator">===</span> newStr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// jack jack true</span>
newStr <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;基本数据类型赋值&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> newStr<span class="token punctuation">,</span> str <span class="token operator">===</span> newStr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// jack mike false</span>

<span class="token comment">// 引用数据类型赋值</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  d<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newArr <span class="token operator">=</span> arr<span class="token punctuation">;</span> <span class="token comment">// 进行赋值</span>
<span class="token keyword">let</span> newObj <span class="token operator">=</span> obj<span class="token punctuation">;</span>

<span class="token comment">// 更改数据</span>
newArr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>d<span class="token punctuation">.</span>e <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;引用数据类型赋值&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 3, 5, 7 ] [ 1, 3, 5, 7 ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;引用数据类型赋值&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 1, b: 2, d: { e: 'mike' }, c: 3 } { a: 1, b: 2, d: { e: 'mike' }, c: 3 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArr <span class="token operator">===</span> arr<span class="token punctuation">,</span> newObj <span class="token operator">===</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true true</span>

<span class="token comment">// 赋值一个新对象</span>
newObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">34</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;引用数据类型赋值&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { name: 'jack', age: 34 } { a: 1, b: 2, d: { e: 'mike' }, c: 3 }</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>首先，对于基本数据类型，赋值操作就是把 <code>值</code> 复制给了新的变量，两个变量的 <code>值</code> 是独立的，改变其中一个，另一个不会改变，因为复制的是 <code>值</code>。其次，对于引用数据类型，赋值操作，只是把原始数据的 的<code>内存地址</code> （栈内存中）复制给了变量，并没有对堆中的 <code>值</code> 进行的拷贝，只是二者指向的是同一个堆中的<code>值</code>。改变其中一个数据，另一个也会改变，通过 <code>===</code> 判断，数据是相同的，因为相同的 <code>内存地址</code> 指向的是同一份数据，可以说，无论改变原始数据还是新数据，改变的都是同一份数据。
<br><br>如果将给 <code>newObj</code> 或者 <code>newArr</code> 赋值为一个<code>新</code>的对象和数组，而不是只改变对象的<code>属性</code>，会发现原始对象和原始数组并不会被改变。原因是，如果只改变对象的属性，因为新对象的引用是原始对象引用的一个复本，所以更改属性更改的也是指向的<code>同一个对象</code>的<code>属性</code>，但是如果给 <code>newObj</code> 赋值一个新的对象后，一个<code>新的引用</code>产生了，不在是赋值后的引用复本。既然不是同一个对象的不同引用，指向的也就是<code>不同</code>的对象，所以原始对象并不会被修改，数组也是同样的原理。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p><code>===</code> 是对同类型数据的 <code>值</code> 的比较。引用类型赋值后，用 <code>===</code> 比较，因为是同一份数据，所以无论改变原始数据还是新数据，<code>值</code> 是相等的。其次，如果要深入理解赋值操作为何会导致这样的结果，需要深入理解 <code>=</code> 运算符背后的执行机制。这个问题(底层原理)，会在成书出版时添加。在此说明。赋值操作的执行机制对于函数的<code>参数传递</code>同样适用，参数传递也会因为基本类型和引用类型的缘故出现<code>值复制</code>和<code>引用复制</code>的情况，关于参数传递，会在<code>应用场景-函数处理</code>一章讲解。</p></div> <h2 id="二、浅拷贝"><a href="#二、浅拷贝" aria-hidden="true" class="header-anchor">#</a> 二、浅拷贝</h2> <p>以对象的拷贝为例，浅拷贝只会将对象的第一层键值对进行<code>值</code>的拷贝，如果对象中的属性是引用类型数据的话，只会复制<code>内存地址</code>。对于对象的第一层键值对是 <code>基本数据类型</code>，浅拷贝不会有任何问题。</p> <h3 id="循环实现浅拷贝"><a href="#循环实现浅拷贝" aria-hidden="true" class="header-anchor">#</a> 循环实现浅拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一层数据为基本数据类型 数组为例</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">&quot;浅拷贝-基本数据&quot;</span><span class="token punctuation">,</span>
  newArr<span class="token punctuation">,</span>
  arr<span class="token punctuation">,</span>
  newArr <span class="token operator">===</span> arr<span class="token punctuation">,</span>
  newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 1, 3, 5 ] [ 1, 3, 5 ] false true</span>

<span class="token comment">// 第一层数据为基本数据类型 对象为例</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-基本数据&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> newObj <span class="token operator">===</span> obj<span class="token punctuation">,</span> newObj<span class="token punctuation">.</span>a <span class="token operator">===</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 1, b: 2 } { a: 1, b: 2 } false true</span>
newObj<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-基本数据&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 1, b: 2, c: 3 } { a: 1, b: 2 }</span>

<span class="token comment">// 第一层数据为引用类型数据 数组为例</span>
<span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">6</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token number">7</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr1<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newArr1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-数组&quot;</span><span class="token punctuation">,</span> newArr1<span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> newArr1 <span class="token operator">===</span> arr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 1, { a: 6 }, { b: 7 } ] [ 1, { a: 6 }, { b: 7 } ] false</span>
newArr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
newArr1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
newArr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-数组&quot;</span><span class="token punctuation">,</span> newArr1<span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> newArr1 <span class="token operator">===</span> arr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 5, 7, { b: 9 } ] [ 1, { a: 6 }, { b: 9 } ] false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-数组&quot;</span><span class="token punctuation">,</span> newArr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>b <span class="token operator">===</span> arr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 第一层数据为引用类型数据 对象为例</span>

<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  c<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    d<span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  d<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">:</span> <span class="token number">6</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newObj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newObj1<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-对象&quot;</span><span class="token punctuation">,</span> newObj1<span class="token punctuation">,</span> obj1<span class="token punctuation">,</span> newObj1<span class="token punctuation">.</span>c <span class="token operator">===</span> obj1<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 1, c: { d: 4 }, d: { e: 6 } } { a: 1, c: { d: 4 }, d: { e: 6 } } true</span>
newObj1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
newObj1<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
newObj1<span class="token punctuation">.</span>d<span class="token punctuation">.</span>e <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅拷贝-对象&quot;</span><span class="token punctuation">,</span> newObj1<span class="token punctuation">,</span> obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 2, c: 3, d: { e: 8 } } { a: 1, c: { d: 4 }, d: { e: 8 } }</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析：第一层数据为基本数据类型</p> <p>对于第一层数据为基本数据类型的情况，对象为例，浅拷贝会将原始对象的数据拷贝到新的对象。可以发现，<code>newObj === obj</code> 返回<code>false</code>，两个对象不相等，那是因为指向的是不同的内存地址，但 <code>newObj.a === obj.a</code> 返回<code>true</code>，两个对象中拷贝的同名属性是相等的，因为，浅拷贝进行了<code>值</code>的拷贝，所以是相等的。如果其中一个对象改变了属性，另一个不会改变，因为两个对象中的属性是独立的，存在于不同的内存空间。</p></div> <div class="tip custom-block"><p class="custom-block-title">案例解析：第一层数据为引用数据类型</p> <p>对于第一层数据为引用数据类型的情况，对象为例，浅拷贝会将原始对象的数据拷贝到新的对象。可以发现，<code>newObj1.c === obj1.c</code> 返回<code>true</code>，两个对象中拷贝的第一层同名属性是相等的。如果其中一个对象改变了第一层属性，另一个不会改变，但执行 <code>newObj1.d.e = 8</code>，改变了第一层属性嵌套的属性时，另一个对象的同名属性也会被改变，这是因为浅拷贝只会拷贝第一层属性，嵌套的属性拷贝的是内存地址，指向的还是同一份数据。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p>基本数据类型直接将数据存储在栈(stack)中。引用数据类型是在栈内存中存储该对象的引用，真实的数据存放在堆内存里。引用数据类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。</p></div> <h3 id="object-assign-实现浅拷贝"><a href="#object-assign-实现浅拷贝" aria-hidden="true" class="header-anchor">#</a> Object.assign()实现浅拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Object.assign 浅拷贝</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Object.assign&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: { b: 6 }, c: 3 } { a: { b: 6 } }</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p><code>Object.assign</code> 进行对象浅拷贝后，会对第一层属性进行拷贝，所以修改其中一个对象，另一个对象不会被改变。嵌套的属性指向的还是同一个内存地址，指向同一份数据，其中一个对象修改嵌套的属性，另一个对象也会被改变。<code>Object.assign</code>和循环进行浅拷贝的实现是相似的，不做赘述。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p>浅拷贝适合用来拷贝只有一层属性的对象和只有一层元素的数组。处理嵌套数据结构，需要使用深拷贝。</p></div> <h3 id="slice-实现浅拷贝"><a href="#slice-实现浅拷贝" aria-hidden="true" class="header-anchor">#</a> slice()实现浅拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;slice&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[ 6, { name: 'mike' } ] [ 1, { name: 'mike' } ]</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>通过 <code>slice()</code> 拷贝数组，如果修改 <code>newArr</code> 第一层数据，<code>arr</code> 不会被改变，实现的是深拷贝,同理，修改 <code>arr</code> ,<code>newArr</code> 也不会被改变。如果修改嵌套的对象中的数据，实现的确实浅拷贝。这种情况和 <code>for循环</code> 拷贝数据的方法非常相似。</p></div> <h3 id="concat-实现浅拷贝"><a href="#concat-实现浅拷贝" aria-hidden="true" class="header-anchor">#</a> concat()实现浅拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;concat&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 6, { name: 'mike' } ] [ 1, { name: 'mike' } ]</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>通过 <code>concat()</code> 拷贝数组，情况和 <code>slice()</code> 一模一样，不再赘述。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p><code>slice()</code>和 <code>concat()</code>方法不会修改原数组，会返回一个新的数组。</p></div> <h3 id="扩展运算符实现浅拷贝"><a href="#扩展运算符实现浅拷贝" aria-hidden="true" class="header-anchor">#</a> 扩展运算符实现浅拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 扩展运算符深拷贝</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr<span class="token punctuation">]</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;扩展运算符&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 6, { name: 'mike' } ] [ 1, { name: 'mike' } ]</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  sex<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>obj
<span class="token punctuation">}</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>age<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>sex<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;扩展运算符&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { name: 'mike', age: { a: 20 }, sex: [ 1, 2 ] } { name: 'jack', age: { a: 20 }, sex: [ 1, 2 ] }</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>通过 <code>扩展运算符</code> 拷贝数组或者对象，情况和 <code>slice()</code> 一模一样，不再赘述。</p></div> <h2 id="三、深拷贝"><a href="#三、深拷贝" aria-hidden="true" class="header-anchor">#</a> 三、深拷贝</h2> <p>以对象的拷贝为例，深拷贝不但将对象的第一层属性值进行<code>值</code>的拷贝，如果对象中的属性是引用类型数据的话，还会递归地对引用类型数据嵌套的所有属性和元素进行<code>值</code>的拷贝。</p> <h3 id="json-解析"><a href="#json-解析" aria-hidden="true" class="header-anchor">#</a> JSON 解析</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>
  arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;JSON-obj&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { name: 'mike', arr: [ 1, 5 ] } { name: 'jack', arr: [ 1, 2 ] }</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;JSON-arr&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ { name: 'mike' } ] [ { name: 'jack' } ]</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>以对象为例，通过将对象通过 <code>JSON.stringify()</code> 解析成 JSON 字符串，然后再用 <code>JSON.parse()</code> 解析成对象形式赋值给新的对象，对象会开辟新的栈，实现深拷贝。可以发现，修改第一层属性 <code>newObj.name</code>，另一个对象不会被改变，修改嵌套的数据 newObj.arr[1]，另一个对象依然不会被改变，因为深拷贝后，嵌套的数据拷贝的是 <code>值</code>，而不是内存地址。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p>需要注意的是，通过 JSON 解析来深拷贝对象有两个缺点，如果你的对象里有函数，函数无法被拷贝下来，<code>JSON.stringify()</code> 方法是将一个 对象或者数组转换为一个 JSON 字符串，但不能属性和元素是函数。无法拷贝对象原型链上的属性和方法。这类情况的验证处在成书出版时进行添加，当前，只需要知道常规情况如何实现深拷贝即可。</p></div> <h3 id="浅拷贝-递归实现深拷贝"><a href="#浅拷贝-递归实现深拷贝" aria-hidden="true" class="header-anchor">#</a> 浅拷贝+递归实现深拷贝</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 递归实现深拷贝</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">,</span> hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> sourceData<span class="token punctuation">;</span> <span class="token comment">// 非对象返回自身</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查哈希表</span>
  <span class="token keyword">const</span> TargetData <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  hash<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">,</span> TargetData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 哈希表设值</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> sourceData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果属性的值是引用类型 进行递归</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        TargetData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入哈希表</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        TargetData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> sourceData<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> TargetData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试对象深拷贝</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 设置循环引用</span>
obj<span class="token punctuation">.</span>sex <span class="token operator">=</span> obj<span class="token punctuation">;</span> <span class="token comment">// RangeError: Maximum call stack size exceeded</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
newObj<span class="token punctuation">.</span>age<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;递归深拷贝&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { name: 'jack', age: { a: 30 }, sex: [Circular] }</span>
<span class="token comment">// { name: 'jack', age: { a: 18 }, sex: [Circular] }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;递归深拷贝&quot;</span><span class="token punctuation">,</span> newObj<span class="token punctuation">.</span>age<span class="token punctuation">.</span>a <span class="token operator">===</span> obj<span class="token punctuation">.</span>age<span class="token punctuation">.</span>a<span class="token punctuation">,</span> newObj<span class="token punctuation">.</span>name <span class="token operator">===</span> obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// false true</span>

<span class="token comment">// 测试数组深拷贝</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;jack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;mike&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;递归深拷贝&quot;</span><span class="token punctuation">,</span> newArr<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 3, { name: 'mike' } ] [ 1, { name: 'jack' } ]</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">案例解析</p> <p>首先，封装一个类型判断方法，判断是否为 <code>'object'</code> 类型，因为 <code>null</code> 也是 <code>'object'</code> 类型，所以需要排除。其次，提供一个边界判断，如果原始数据不是对象类型，不进行深拷贝，直接返回原始数据，结束函数。最后，遍历对象的属性或数组的索引，<code>isObject(sourceData[key])</code> 表明，如果属性或索引的值是一个对象类型，直接递归函数，再次遍历嵌套的属性和索引，从而实现了对所有嵌套的属性和索引的拷贝。通过测试代码可以发现，无论修改其中一个对象的哪一层属性，另外一个对象的属性都不会被改变，数组同理。</p></div> <div class="warning custom-block"><p class="custom-block-title">说明</p> <p>对于循环引用的处理，可以使用哈希表进行<code>循环检测</code>，我们设置一个数组或者哈希表存储已拷贝过的对象，当检测到当前对象已存在于哈希表中时，取出该值并返回即可。如果没有做处理，会报错：<code>RangeError: Maximum call stack size exceeded</code>。</p></div> <h3 id="我愿与你共享知识-可否陪我共饮香茗"><a href="#我愿与你共享知识-可否陪我共饮香茗" aria-hidden="true" class="header-anchor">#</a> 我愿与你共享知识 可否陪我共饮香茗 🍵</h3> <img src="/The-Secret-of-the-Front-End/assets/wxpay.png" style="height:200px;margin-top:30px;margin-right:80px"> <img src="/The-Secret-of-the-Front-End/assets/alipay.jpg" style="height:200px;margin-top:30px;"></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/iwujingfeng/The-Secret-of-the-Front-End/edit/master/docs/scene/copy.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">4/1/2019, 10:24:45 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/The-Secret-of-the-Front-End/scene/array-filter.html" class="prev">
          数组过滤
        </a></span> <span class="next"><a href="/The-Secret-of-the-Front-End/scene/async.html">
          异步处理
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/The-Secret-of-the-Front-End/assets/js/10.e0b122c8.js" defer></script><script src="/The-Secret-of-the-Front-End/assets/js/app.d61db1a3.js" defer></script>
  </body>
</html>
